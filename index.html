<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Warrior Quiz Arena - Ancient Indian Battle (Fixed)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { box-sizing: border-box; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); } 50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    .warrior-bg { background: linear-gradient(135deg, #8B4513 0%, #D2691E 50%, #CD853F 100%); }
    .ancient-pattern { background-image:
      radial-gradient(circle at 25% 25%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),
      radial-gradient(circle at 75% 75%, rgba(255, 69, 0, 0.1) 0%, transparent 50%);
    }
    .weapon-shadow { filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)); }
    .timer-ring { stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 1s linear; }
  </style>
  <!-- Supabase JS -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
</head>
<body class="warrior-bg ancient-pattern min-h-screen">
  <!-- Login Screen -->
  <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
    <div class="bg-gradient-to-br from-amber-100 to-orange-100 rounded-3xl shadow-2xl p-8 max-w-md w-full border-4 border-amber-600">
      <div class="text-center mb-8">
        <div class="text-6xl mb-4">‚öîÔ∏è</div>
        <h1 class="text-3xl font-bold text-amber-900 mb-2">Warrior Quiz Arena</h1>
        <p class="text-amber-700">Enter the Ancient Battle</p>
      </div>

      <div class="space-y-4">
        <div>
          <label class="block text-amber-800 font-semibold mb-2">Username</label>
          <input type="text" id="username" class="w-full px-4 py-3 rounded-xl border-2 border-amber-300 focus:border-amber-600 focus:outline-none" placeholder="Enter username" />
        </div>

        <div>
          <label class="block text-amber-800 font-semibold mb-2">Password</label>
          <input type="password" id="password" class="w-full px-4 py-3 rounded-xl border-2 border-amber-300 focus:border-amber-600 focus:outline-none" placeholder="Enter password" />
        </div>

        <div class="flex space-x-4">
          <button onclick="login('admin')" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105">üõ°Ô∏è Admin</button>
          <button onclick="login('participant')" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105">‚öîÔ∏è Warrior</button>
        </div>
      </div>

      <div class="mt-6 text-sm text-amber-700 bg-amber-50 p-4 rounded-xl">
        <p><strong>Admin:</strong> admin / admin123</p>
        <p><strong>Warriors:</strong> warrior1-8 / battle123</p>
      </div>
    </div>
  </div>

  <!-- Admin Dashboard -->
  <div id="adminDashboard" class="hidden min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
      <div class="bg-gradient-to-r from-red-800 to-red-600 rounded-2xl p-6 mb-6 text-white">
        <div class="flex justify-between items-center">
          <div>
            <h1 class="text-3xl font-bold flex items-center">üõ°Ô∏è Admin Command Center</h1>
            <p class="text-red-200">Control the Ancient Battle Arena</p>
          </div>
          <button onclick="logout()" class="bg-red-900 hover:bg-red-800 px-4 py-2 rounded-lg transition-colors">Logout</button>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Question Management -->
        <div class="bg-white rounded-2xl shadow-xl p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">üìú Question Scroll</h2>

          <div class="space-y-4">
            <input type="text" id="adminQuestionText" placeholder="Enter your battle question..." class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:border-amber-500 focus:outline-none" />

            <div class="grid grid-cols-2 gap-2">
              <input type="text" id="adminOptionA" placeholder="Option A" class="px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-amber-500 focus:outline-none" />
              <input type="text" id="adminOptionB" placeholder="Option B" class="px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-amber-500 focus:outline-none" />
              <input type="text" id="adminOptionC" placeholder="Option C" class="px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-amber-500 focus:outline-none" />
              <input type="text" id="adminOptionD" placeholder="Option D" class="px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-amber-500 focus:outline-none" />
            </div>

            <div class="flex space-x-4">
              <select id="adminCorrectAnswer" class="flex-1 px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-amber-500 focus:outline-none">
                <option value="">Select Correct Answer</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
              </select>

              <input type="number" id="adminQuestionTimer" placeholder="Timer (sec)" min="10" max="120" value="30" class="w-24 px-3 py-2 rounded-lg border-2 border-gray-300 focus:border-amber-500 focus:outline-none" />
            </div>

            <button onclick="postQuestion()" class="w-full bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-6 rounded-xl transition-all duration-300 transform hover:scale-105">üèπ Launch Question</button>
          </div>
        </div>

        <!-- Live Stats -->
        <div class="bg-white rounded-2xl shadow-xl p-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">‚ö° Battle Statistics</h2>

          <div class="space-y-4">
            <div class="bg-green-50 p-4 rounded-xl">
              <h3 class="font-bold text-green-800 mb-2">‚ö° Fastest Finger</h3>
              <div id="fastestFinger" class="text-green-600">Waiting for answers...</div>
            </div>

            <div class="bg-blue-50 p-4 rounded-xl">
              <h3 class="font-bold text-blue-800 mb-2">üë• Active Warriors</h3>
              <div id="activeParticipants" class="text-blue-600">0 / 8 warriors online</div>
            </div>

            <div class="bg-purple-50 p-4 rounded-xl">
              <h3 class="font-bold text-purple-800 mb-2">üìä Current Question</h3>
              <div id="currentQuestionStatus" class="text-purple-600">No active question</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin Leaderboard -->
      <div class="mt-6 bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">üèÜ Warrior Leaderboard</h2>
        <div id="adminLeaderboard" class="space-y-2"></div>
      </div>
    </div>
  </div>

  <!-- Participant Dashboard -->
  <div id="participantDashboard" class="hidden min-h-screen p-6">
    <div class="max-w-4xl mx-auto">
      <div class="bg-gradient-to-r from-blue-800 to-blue-600 rounded-2xl p-6 mb-6 text-white">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-4">
            <div id="participantAvatar" class="text-4xl"></div>
            <div>
              <h1 class="text-2xl font-bold" id="participantName">Warrior</h1>
              <p class="text-blue-200">Ready for Battle</p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-3xl font-bold" id="participantScore">0</div>
            <div class="text-blue-200">Points</div>
            <button onclick="logout()" class="mt-2 bg-blue-900 hover:bg-blue-800 px-4 py-2 rounded-lg transition-colors">Logout</button>
          </div>
        </div>
      </div>

      <!-- Question Area -->
      <div id="questionArea" class="bg-white rounded-2xl shadow-xl p-8 mb-6 hidden">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-2xl font-bold text-gray-800">Battle Question</h2>
          <div class="relative w-16 h-16">
            <svg class="w-16 h-16 transform -rotate-90">
              <circle cx="32" cy="32" r="28" stroke="#e5e7eb" stroke-width="4" fill="none"></circle>
              <circle id="timerCircle" cx="32" cy="32" r="28" stroke="#f59e0b" stroke-width="4" fill="none" class="timer-ring"></circle>
            </svg>
            <div id="timerText" class="absolute inset-0 flex items-center justify-center text-xl font-bold text-amber-600">30</div>
          </div>
        </div>

        <div id="participantQuestionText" class="text-xl text-gray-800 mb-6 p-4 bg-amber-50 rounded-xl border-l-4 border-amber-500">Waiting for question...</div>

        <div id="optionsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
      </div>

      <!-- Waiting Area -->
      <div id="waitingArea" class="bg-white rounded-2xl shadow-xl p-8 text-center">
        <div class="text-6xl mb-4 animate-bounce">‚öîÔ∏è</div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Preparing for Battle</h2>
        <p class="text-gray-600">Waiting for the next question from the battle master...</p>
      </div>

      <!-- Participant Leaderboard -->
      <div class="mt-6 bg-white rounded-2xl shadow-xl p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">üèÜ Warrior Rankings</h2>
        <div id="participantLeaderboard" class="space-y-2"></div>
      </div>
    </div>
  </div>

  <script>
  // ===================== SUPABASE CONFIG =====================
  // TODO: Paste your Supabase project URL and anon key here
  const SUPABASE_URL = "https://iondedmhlyonsmpqulhq.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvbmRlZG1obHlvbnNtcHF1bGhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyOTQ2MjQsImV4cCI6MjA3NDg3MDYyNH0.WFo2SfBf_Z2_e6C_pSuT8YStTCAD9pdGo90JNrgZdzM";
  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // TABLES USED (create these in Supabase):
  // questions(id bigint generated by default as identity primary key,
  //           text text not null,
  //           options jsonb not null,
  //           correct text not null,
  //           timer int not null,
  //           start_time timestamptz not null,
  //           ends_at timestamptz not null,
  //           ended boolean not null default false)
  // answers(id bigint generated by default as identity primary key,
  //         question_id bigint references questions(id) on delete cascade,
  //         username text not null,
  //         answer text not null,
  //         time_ms int not null,
  //         is_correct boolean not null,
  //         created_at timestamptz not null default now(),
  //         unique(question_id, username))
  // Make sure RLS is ON and add policies to allow:
  // - SELECT on questions to everyone
  // - INSERT on answers to everyone, and SELECT on answers to everyone

  // ===================== LOCAL STATE (UI only) =====================
  const STORAGE_KEY = 'warriorQuizState_v3';

  let gameState = {
    currentUser: null,
    userType: null,
    participants: {},
    currentQuestion: null,
    questionTimer: null,
    leaderboard: []
  };

  const warriorAvatars = ['üèπ','‚öîÔ∏è','üõ°Ô∏è','üó°Ô∏è','üè∫','üéØ','‚ö°','üî•'];
  const credentials = {
    admin: { username: 'admin', password: 'admin123' },
    participants: { warrior1:'battle123', warrior2:'battle123', warrior3:'battle123', warrior4:'battle123', warrior5:'battle123', warrior6:'battle123', warrior7:'battle123', warrior8:'battle123' }
  };

  function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify({currentUser:gameState.currentUser,userType:gameState.userType,participants:gameState.participants,leaderboard:gameState.leaderboard})); }
  function loadState(){ try{ const s=JSON.parse(localStorage.getItem(STORAGE_KEY)||'null'); if(!s) return; gameState.currentUser=s.currentUser||null; gameState.userType=s.userType||null; gameState.participants=s.participants||{}; gameState.leaderboard=s.leaderboard||[]; }catch{}}

  function initializeParticipants(){ if(Object.keys(gameState.participants).length) {updateLeaderboard();return;} Object.keys(credentials.participants).forEach((u,i)=>{gameState.participants[u]={name:u,avatar:warriorAvatars[i],score:0,online:false,lastAnswerTime:null};}); updateLeaderboard(); }

  // ===================== AUTH =====================
  function login(type){
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!username||!password){alert('Please enter both username and password!');return;}
    let ok=false; if(type==='admin'){ ok = (username===credentials.admin.username && password===credentials.admin.password); } else { ok = credentials.participants[username]===password; }
    if(!ok){ alert('Invalid credentials!'); return; }
    gameState.currentUser=username; gameState.userType=type;
    if(type==='participant'){
      if(!gameState.participants[username]) gameState.participants[username]={name:username,avatar:'‚öîÔ∏è',score:0,online:true,lastAnswerTime:null};
      gameState.participants[username].online=true;
      document.getElementById('participantName').textContent=username;
      document.getElementById('participantAvatar').textContent=gameState.participants[username].avatar;
      document.getElementById('participantScore').textContent=gameState.participants[username].score;
    }
    showDashboard(type); updateActiveParticipants(); updateLeaderboard(); saveState();
    // On login, pull any active question from Supabase immediately
    fetchActiveQuestion();
  }

  function showDashboard(type){ document.getElementById('loginScreen').classList.add('hidden'); if(type==='admin'){ document.getElementById('adminDashboard').classList.remove('hidden'); } else { document.getElementById('participantDashboard').classList.remove('hidden'); } }

  function logout(){ if(gameState.userType==='participant' && gameState.currentUser){ gameState.participants[gameState.currentUser].online=false; }
    gameState.currentUser=null; gameState.userType=null;
    document.getElementById('adminDashboard').classList.add('hidden');
    document.getElementById('participantDashboard').classList.add('hidden');
    document.getElementById('loginScreen').classList.remove('hidden');
    document.getElementById('username').value=''; document.getElementById('password').value='';
    updateActiveParticipants(); updateLeaderboard(); saveState();
  }

  // ===================== SUPABASE: QUESTIONS =====================
  async function fetchActiveQuestion(){
    const { data, error } = await sb
      .from('questions')
      .select('*')
      .eq('ended', false)
      .gt('ends_at', new Date().toISOString())
      .order('start_time', { ascending: false })
      .limit(1);
    if(error){ console.error('fetchActiveQuestion error', error); return; }
    if(data && data.length){ setCurrentQuestion(data[0]); } else { clearQuestionUI(); }
  }

  function setCurrentQuestion(q){
    gameState.currentQuestion = {
      id: q.id,
      text: q.text,
      options: q.options,
      correct: q.correct,
      timer: q.timer,
      startTime: new Date(q.start_time).getTime(),
      endsAt: new Date(q.ends_at).getTime()
    };
    if(gameState.userType==='participant'){ displayQuestionToParticipants(); }
    startOrSyncTimer();
    updateCurrentQuestionStatus();
    updateFastestFinger();
  }

  function clearQuestionUI(){
    gameState.currentQuestion = null;
    if(gameState.userType==='participant'){
      document.getElementById('questionArea').classList.add('hidden');
      document.getElementById('waitingArea').classList.remove('hidden');
    }
    updateCurrentQuestionStatus();
    { const ff = document.getElementById('fastestFinger'); if (ff) ff.innerText = 'Waiting for answers...'; }
  }

  // Realtime subscription: get new questions and updates instantly
  const questionChannel = sb
    .channel('questions-listen')
    .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'questions' }, (payload) => {
      const q = payload.new; if(!q.ended && new Date(q.ends_at) > new Date()) setCurrentQuestion(q);
    })
    .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'questions' }, (payload) => {
      const q = payload.new; if(q.ended || new Date(q.ends_at) <= new Date()) { clearQuestionUI(); } else { setCurrentQuestion(q); }
    })
    .subscribe();

  // ===================== ADMIN: POST QUESTION =====================
  async function postQuestion(){
    const questionText = document.getElementById('adminQuestionText').value.trim();
    const optionA = document.getElementById('adminOptionA').value.trim();
    const optionB = document.getElementById('adminOptionB').value.trim();
    const optionC = document.getElementById('adminOptionC').value.trim();
    const optionD = document.getElementById('adminOptionD').value.trim();
    const correctAnswer = document.getElementById('adminCorrectAnswer').value;
    const timer = parseInt(document.getElementById('adminQuestionTimer').value)||30;

    if(!questionText||!optionA||!optionB||!optionC||!optionD||!correctAnswer){ alert('Please fill in all fields!'); return; }

    // End any existing active question
    await sb.from('questions').update({ ended: true }).eq('ended', false);

    const start = new Date();
    const ends = new Date(start.getTime() + timer*1000);
    const newQ = {
      text: questionText,
      options: { A: optionA, B: optionB, C: optionC, D: optionD },
      correct: correctAnswer,
      timer: timer,
      start_time: start.toISOString(),
      ends_at: ends.toISOString(),
      ended: false
    };

    const { data, error } = await sb.from('questions').insert(newQ).select('*').single();
    if(error){ console.error('postQuestion error', error); alert('Could not post question. Check Supabase URL/key and table setup.'); return; }

    // Clear admin form
    document.getElementById('adminQuestionText').value='';
    document.getElementById('adminOptionA').value='';
    document.getElementById('adminOptionB').value='';
    document.getElementById('adminOptionC').value='';
    document.getElementById('adminOptionD').value='';
    document.getElementById('adminCorrectAnswer').value='';

    // Realtime will deliver it to participants; also set locally for the admin UI
    setCurrentQuestion(data);
  }

  // ===================== PARTICIPANTS: DISPLAY & ANSWER =====================
  function displayQuestionToParticipants(){
    const qa = document.getElementById('questionArea');
    const wa = document.getElementById('waitingArea');
    const q = gameState.currentQuestion; if(!q){ qa.classList.add('hidden'); wa.classList.remove('hidden'); return; }
    wa.classList.add('hidden'); qa.classList.remove('hidden');
    document.getElementById('participantQuestionText').textContent = q.text;
    const optionsContainer = document.getElementById('optionsContainer'); optionsContainer.innerHTML='';
    Object.entries(q.options).forEach(([key, val])=>{
      const btn = document.createElement('button');
      btn.className='bg-gradient-to-r from-amber-400 to-amber-600 hover:from-amber-500 hover:to-amber-700 text-white font-bold py-4 px-6 rounded-xl transition-all duration-300 transform hover:scale-105 text-left';
      btn.innerHTML = `<span class="text-xl font-bold">${key}.</span> ${val}`;
      btn.onclick = () => submitAnswer(key);
      optionsContainer.appendChild(btn);
    });
  }

  async function submitAnswer(answer){
    const q = gameState.currentQuestion; if(!q || !gameState.currentUser) return;
    const now = Date.now(); const timeTaken = now - q.startTime; const isCorrect = (answer === q.correct);

    // Prevent double answers
    const existing = await sb.from('answers').select('id').eq('question_id', q.id).eq('username', gameState.currentUser).maybeSingle();
    if(existing.data){ disableAndHighlight(answer, q.correct); return; }

    const { error } = await sb.from('answers').insert({ question_id: q.id, username: gameState.currentUser, answer, time_ms: timeTaken, is_correct: isCorrect });
    if(error){ console.error('submitAnswer error', error); alert('Could not submit answer (check policies for answers table).'); }

    // Local scoring (client-side demo). For real events keep scores server-side.
    let points = 0; if(isCorrect){ points = 100 + Math.max(0, 50 - Math.floor(timeTaken/1000)); }
    if(gameState.participants[gameState.currentUser]){
      gameState.participants[gameState.currentUser].score += points;
      gameState.participants[gameState.currentUser].lastAnswerTime = timeTaken;
      document.getElementById('participantScore').textContent = gameState.participants[gameState.currentUser].score;
    }

    disableAndHighlight(answer, q.correct);
    updateLeaderboard(); saveState();
    updateFastestFinger();
  }

  function disableAndHighlight(answer, correct){
    const buttons = document.querySelectorAll('#optionsContainer button');
    buttons.forEach(btn=>{ btn.disabled=true; btn.classList.add('opacity-50','cursor-not-allowed'); });
    buttons.forEach((btn, idx)=>{
      const key = ['A','B','C','D'][idx];
      if(key===correct){ btn.classList.remove('from-amber-400','to-amber-600'); btn.classList.add('from-green-400','to-green-600'); }
      else if(key===answer && answer!==correct){ btn.classList.remove('from-amber-400','to-amber-600'); btn.classList.add('from-red-400','to-red-600'); }
    });
  }

  // ===================== TIMER =====================
  function startOrSyncTimer(){
    clearInterval(gameState.questionTimer);
    const q = gameState.currentQuestion; if(!q) return;
    const circle = document.getElementById('timerCircle'); const text = document.getElementById('timerText');
    function tick(){
      const now = Date.now(); const remainingMs = q.endsAt - now; const remaining = Math.max(0, Math.ceil(remainingMs/1000));
      if(text) text.textContent = remaining;
      if(circle){ const elapsed = Math.min(q.timer, Math.max(0, Math.floor((now - q.startTime)/1000))); const progress = elapsed / q.timer; const offset = 283 - progress*283; circle.style.strokeDashoffset = offset; }
      if(remaining<=0){ clearInterval(gameState.questionTimer); endQuestion(); }
    }
    tick(); gameState.questionTimer = setInterval(tick, 1000);
  }

  async function endQuestion(){
    clearInterval(gameState.questionTimer); gameState.currentQuestion=null;
    if(gameState.userType==='participant'){ document.getElementById('questionArea').classList.add('hidden'); document.getElementById('waitingArea').classList.remove('hidden'); }
    updateCurrentQuestionStatus(); updateFastestFinger(); updateLeaderboard(); saveState();
  }

  // ===================== LIVE STATS =====================
  async function updateFastestFinger(){
    const el = document.getElementById('fastestFinger'); if(!el) return;
    const q = gameState.currentQuestion; if(!q){ el.textContent='Waiting for answers...'; return; }
    const { data, error } = await sb.from('answers').select('username,time_ms,is_correct').eq('question_id', q.id);
    if(error){ console.error('fastest error', error); el.textContent='Waiting for answers...'; return; }
    const correct = (data||[]).filter(r=>r.is_correct);
    if(!correct.length){ el.textContent='No correct answers yet...'; return; }
    correct.sort((a,b)=>a.time_ms-b.time_ms); const f = correct[0];
    const avatar = gameState.participants[f.username]?.avatar || '‚ö°';
    el.innerHTML = `${avatar} ${f.username} (${(f.time_ms/1000).toFixed(1)}s)`;
    const answeredCount = (data||[]).length; const statusEl = document.getElementById('currentQuestionStatus'); if(statusEl) statusEl.textContent = `Active - ${answeredCount} warriors answered`;
  }

  function updateActiveParticipants(){
    const count = Object.values(gameState.participants).filter(p=>p.online).length;
    const el = document.getElementById('activeParticipants'); if(el) el.textContent = `${count} / 8 warriors online`;
  }

  function updateCurrentQuestionStatus(){
    const el = document.getElementById('currentQuestionStatus'); if(!el) return;
    const q = gameState.currentQuestion; if(q){ el.textContent = 'Active - gathering answers...'; } else { el.textContent = 'No active question'; }
  }

  function updateLeaderboard(){
    const sorted = Object.values(gameState.participants).sort((a,b)=>b.score-a.score);
    const adminBoard = document.getElementById('adminLeaderboard'); if(adminBoard){ adminBoard.innerHTML = sorted.map((p,i)=>{
      const medal = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'üèÖ'; const statusColor = p.online?'text-green-600':'text-gray-400'; const status=p.online?'Online':'Offline';
      return `<div class="flex items-center justify-between p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200">
        <div class="flex items-center space-x-4">
          <span class="text-2xl">${medal}</span>
          <span class="text-2xl">${p.avatar}</span>
          <div><div class="font-bold text-gray-800">${p.name}</div><div class="text-sm ${statusColor}">${status}</div></div>
        </div>
        <div class="text-right"><div class="text-2xl font-bold text-amber-600">${p.score}</div><div class="text-sm text-gray-600">points</div></div>
      </div>`; }).join(''); }

    const participantBoard = document.getElementById('participantLeaderboard'); if(participantBoard){ participantBoard.innerHTML = sorted.map((p,i)=>{
      const medal = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':'üèÖ'; const me = p.name===gameState.currentUser; const hl = me?'ring-2 ring-blue-500 bg-blue-50':'bg-gray-50';
      return `<div class="flex items-center justify-between p-4 ${hl} rounded-xl border border-gray-200">
        <div class="flex items-center space-x-4">
          <span class="text-2xl">${medal}</span>
          <span class="text-2xl">${p.avatar}</span>
          <div><div class="font-bold text-gray-800">${p.name} ${me?'(You)':''}</div><div class="text-sm text-gray-600">Rank #${i+1}</div></div>
        </div>
        <div class="text-right"><div class="text-2xl font-bold text-amber-600">${p.score}</div><div class="text-sm text-gray-600">points</div></div>
      </div>`; }).join(''); }
  }

  // ===================== BOOT =====================
  (function boot(){
    loadState(); initializeParticipants();
    if(gameState.userType){ showDashboard(gameState.userType); if(gameState.userType==='participant' && gameState.currentUser){ document.getElementById('participantName').textContent=gameState.currentUser; document.getElementById('participantAvatar').textContent=gameState.participants[gameState.currentUser]?.avatar||'‚öîÔ∏è'; document.getElementById('participantScore').textContent=gameState.participants[gameState.currentUser]?.score||0; }}
    fetchActiveQuestion(); updateActiveParticipants(); updateLeaderboard();
    window.addEventListener('beforeunload', saveState);
  })();
</script>
</body>
</html>
